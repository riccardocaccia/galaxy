---
#NOT TESTED

- name: Install Dependencies for CentOS7
  package:
    name: ['acl', 'bzip2', 'git', 'make', 'python-psycopg2', 'python3-psycopg2', 'tar', 'python3-virtualenv',  'gcc', 'openssl-devel', 'bzip2-devel', 'libffi-devel', 'zlib-devel', 'xz-devel', 'sqlite-devel', 'wget']
 
- name: Check if python is installed
  stat: path=/usr/local/bin/python3.7
  register: python3
  
- name: Download and unarchive Python 3.11.9
  unarchive:
    src: https://www.python.org/ftp/python/3.11.9/Python-3.11.9.tgz
    dest: /tmp
    remote_src: yes
  when: not python3.stat.exists

- name: Configure, compile and install Python 3.11
  shell: cd /tmp/Python-3.11.9 && {{ item }}
  with_items:
    - ./configure --enable-optimizations
    - make altinstall
  when: not python3.stat.exists

- name: Correct python version selected
  alternatives:
    name: python3
    link: /usr/bin/python3
    path: /usr/local/bin/python3.11
